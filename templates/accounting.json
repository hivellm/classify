{
  "$schema": "https://hivellm.org/schemas/classify-template-v1.json",
  "version": "1.0",
  
  "metadata": {
    "name": "accounting",
    "display_name": "Accounting Documents",
    "description": "Classification template for accounting documents including ledgers, journals, reconciliations, and financial statements",
    "domains": ["accounting", "finance", "bookkeeping"],
    "priority": 88,
    
    "indicators": [
      "ledger", "journal", "account", "debit", "credit",
      "balance sheet", "income statement", "reconciliation",
      "general ledger", "accounts payable", "accounts receivable",
      "trial balance", "posting", "entry", "accrual"
    ],
    
    "document_types": [
      "general_ledger", "journal_entry", "trial_balance",
      "balance_sheet", "income_statement", "cash_flow",
      "reconciliation", "accounts_payable", "accounts_receivable"
    ],
    
    "example_titles": [
      "General Ledger December 2024",
      "Journal Entry #12345",
      "Bank Reconciliation Statement",
      "Trial Balance Q4 2024",
      "Balance Sheet 2024",
      "Income Statement YTD"
    ],
    
    "use_cases": [
      "Financial reporting and analysis",
      "Account reconciliation",
      "Audit trail and compliance",
      "General ledger management",
      "Financial statement preparation"
    ]
  },
  
  "llm_config": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "temperature": 0.05,
    "max_tokens": 2000,
    "system_prompt": "You are an expert accounting document classifier. Extract account numbers, ledger entries, debits, credits, balances, fiscal periods, and financial statement items with extreme precision. Always preserve exact numerical values, account codes, and accounting terminology. Identify double-entry bookkeeping patterns.",
    "fallback_models": ["gpt-4o-mini", "claude-3-5-haiku-latest"]
  },
  
  "document_types": [
    {
      "type": "journal_entry",
      "display_name": "Journal Entry",
      "description": "Accounting journal entry",
      "indicators": ["journal", "entry", "debit", "credit", "posting"],
      "required_entities": ["entry_number", "date", "account", "amount"],
      "optional_entities": ["description", "reference"],
      "priority": 100
    },
    {
      "type": "general_ledger",
      "display_name": "General Ledger",
      "description": "General ledger report",
      "indicators": ["general ledger", "gl", "account balance"],
      "required_entities": ["account", "balance", "period"],
      "optional_entities": ["transactions"],
      "priority": 95
    },
    {
      "type": "balance_sheet",
      "display_name": "Balance Sheet",
      "description": "Balance sheet statement",
      "indicators": ["balance sheet", "assets", "liabilities", "equity"],
      "required_entities": ["period", "assets", "liabilities"],
      "optional_entities": ["equity"],
      "priority": 90
    }
  ],
  
  "entity_definitions": [
    {
      "type": "Account",
      "description": "Chart of accounts account",
      "properties": {
        "account_number": { "type": "string", "required": true },
        "account_name": { "type": "string", "required": true },
        "account_type": {
          "type": "enum",
          "values": ["asset", "liability", "equity", "revenue", "expense"],
          "required": true
        },
        "balance": { "type": "number", "required": false }
      },
      "extraction_methods": ["pattern", "llm"]
    },
    {
      "type": "JournalEntry",
      "description": "Accounting journal entry",
      "properties": {
        "entry_number": { "type": "string", "required": true },
        "date": { "type": "date", "required": true },
        "description": { "type": "string", "required": false },
        "reference": { "type": "string", "required": false },
        "posted_by": { "type": "string", "required": false }
      },
      "extraction_methods": ["llm", "pattern"]
    },
    {
      "type": "Transaction",
      "description": "Accounting transaction line",
      "properties": {
        "account": { "type": "string", "required": true },
        "debit": { "type": "number", "required": false },
        "credit": { "type": "number", "required": false },
        "description": { "type": "string", "required": false }
      },
      "extraction_methods": ["pattern", "llm"]
    },
    {
      "type": "Period",
      "description": "Accounting period",
      "properties": {
        "period_type": {
          "type": "enum",
          "values": ["month", "quarter", "year", "ytd"],
          "required": true
        },
        "start_date": { "type": "date", "required": false },
        "end_date": { "type": "date", "required": false },
        "fiscal_year": { "type": "number", "required": false }
      },
      "extraction_methods": ["pattern", "llm"]
    },
    {
      "type": "Amount",
      "description": "Monetary amount",
      "properties": {
        "value": { "type": "number", "required": true },
        "currency": { "type": "string", "required": true },
        "type": {
          "type": "enum",
          "values": ["debit", "credit", "balance"],
          "required": true
        }
      },
      "extraction_methods": ["pattern"]
    }
  ],
  
  "relationship_definitions": [
    {
      "type": "DEBITS",
      "description": "Transaction debits account",
      "source": "Transaction",
      "target": ["Account"],
      "properties": {
        "amount": { "type": "number", "required": true },
        "date": { "type": "date", "required": false }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "CREDITS",
      "description": "Transaction credits account",
      "source": "Transaction",
      "target": ["Account"],
      "properties": {
        "amount": { "type": "number", "required": true },
        "date": { "type": "date", "required": false }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "PART_OF",
      "description": "Transaction part of journal entry",
      "source": "Transaction",
      "target": ["JournalEntry"],
      "properties": {},
      "extraction_methods": ["llm"]
    },
    {
      "type": "FOR_PERIOD",
      "description": "Document for accounting period",
      "source": "Document",
      "target": ["Period"],
      "properties": {},
      "extraction_methods": ["llm"]
    }
  ],
  
  "graph_schema": {
    "nodes": [
      {
        "type": "AccountingDocument",
        "labels": ["Document", "AccountingDocument"],
        "required_properties": ["id", "title", "doc_type", "period"],
        "optional_properties": ["fiscal_year", "created_at", "posted_by"],
        "indexes": [
          { "property": "id", "type": "unique" },
          { "property": "period", "type": "index" },
          { "property": "fiscal_year", "type": "index" }
        ]
      },
      {
        "type": "Account",
        "labels": ["Account"],
        "required_properties": ["account_number", "account_name", "account_type"],
        "optional_properties": ["balance", "parent_account"],
        "indexes": [
          { "property": "account_number", "type": "unique" },
          { "property": "account_type", "type": "index" }
        ]
      },
      {
        "type": "JournalEntry",
        "labels": ["JournalEntry"],
        "required_properties": ["entry_number", "date"],
        "optional_properties": ["description", "reference", "posted_by"],
        "indexes": [
          { "property": "entry_number", "type": "unique" },
          { "property": "date", "type": "index" }
        ]
      }
    ],
    
    "relationships": [
      {
        "type": "DEBITS",
        "source": "Transaction",
        "target": "Account",
        "properties": ["amount", "date"],
        "required": ["amount"]
      },
      {
        "type": "CREDITS",
        "source": "Transaction",
        "target": "Account",
        "properties": ["amount", "date"],
        "required": ["amount"]
      }
    ]
  },
  
  "fulltext_schema": {
    "required_fields": ["title", "domain", "doc_type", "period"],
    
    "extracted_fields": [
      {
        "name": "period",
        "type": "string",
        "description": "Accounting period",
        "extraction_method": "pattern",
        "patterns": ["\\d{4}-\\d{2}", "Q[1-4]\\s*\\d{4}", "FY\\s*\\d{4}"],
        "index": true
      },
      {
        "name": "fiscal_year",
        "type": "number",
        "description": "Fiscal year",
        "extraction_method": "pattern",
        "patterns": ["FY\\s*(\\d{4})", "(\\d{4})"],
        "index": true
      },
      {
        "name": "accounts",
        "type": "array",
        "description": "Account numbers mentioned",
        "extraction_method": "pattern",
        "patterns": ["\\d{4,6}"],
        "index": true
      },
      {
        "name": "total_debits",
        "type": "number",
        "description": "Total debit amount",
        "extraction_method": "llm",
        "index": false
      },
      {
        "name": "total_credits",
        "type": "number",
        "description": "Total credit amount",
        "extraction_method": "llm",
        "index": false
      },
      {
        "name": "balanced",
        "type": "boolean",
        "description": "Whether debits equal credits",
        "extraction_method": "llm",
        "index": true
      }
    ],
    
    "keyword_extraction": {
      "enabled": true,
      "method": "tfidf",
      "min_frequency": 1,
      "max_keywords": 15,
      "exclude_stopwords": true,
      "preserve_entities": true
    },
    
    "categories": ["accounting", "finance", "bookkeeping", "audit"],
    
    "summary": {
      "enabled": true,
      "method": "llm",
      "max_length": 300
    }
  },
  
  "extraction_rules": [
    {
      "name": "extract_accounts",
      "description": "Extract account numbers and names",
      "method": "pattern",
      "patterns": [
        "(\\d{4,6})\\s+([A-Za-z\\s&-]+)",
        "Account\\s+(\\d{4,6})"
      ],
      "post_processing": ["deduplicate"]
    },
    {
      "name": "extract_journal_entries",
      "description": "Extract journal entry details",
      "method": "llm",
      "prompt": "Extract all journal entries with entry numbers, dates, accounts, debits, and credits. Verify that debits equal credits."
    },
    {
      "name": "extract_amounts",
      "description": "Extract debit and credit amounts",
      "method": "pattern",
      "patterns": [
        {
          "pattern": "(?:debit|dr)\\s*:?\\s*\\$?([0-9,]+(?:\\.[0-9]{2})?)",
          "type": "debit",
          "flags": "i"
        },
        {
          "pattern": "(?:credit|cr)\\s*:?\\s*\\$?([0-9,]+(?:\\.[0-9]{2})?)",
          "type": "credit",
          "flags": "i"
        }
      ]
    },
    {
      "name": "extract_period",
      "description": "Extract accounting period",
      "method": "pattern",
      "patterns": [
        "\\d{4}-\\d{2}",
        "Q[1-4]\\s*\\d{4}",
        "FY\\s*\\d{4}",
        "(?:January|February|March|April|May|June|July|August|September|October|November|December)\\s*\\d{4}"
      ],
      "flags": "i"
    }
  ],
  
  "validation_rules": [
    {
      "field": "period",
      "rules": [
        { "type": "required", "message": "Accounting period is required" }
      ]
    },
    {
      "field": "accounts",
      "rules": [
        { "type": "min_length", "value": 1, "message": "At least one account must be identified" }
      ]
    },
    {
      "field": "total_debits",
      "rules": [
        { "type": "min_value", "value": 0, "message": "Debits must be non-negative" }
      ]
    },
    {
      "field": "total_credits",
      "rules": [
        { "type": "min_value", "value": 0, "message": "Credits must be non-negative" }
      ]
    }
  ]
}

