{
  "$schema": "https://hivellm.org/schemas/classify-template-v1.json",
  "version": "1.0",
  
  "metadata": {
    "name": "financial",
    "display_name": "Financial Documents",
    "description": "Classification template for financial documents including invoices, receipts, reports, and transactions",
    "domains": ["financial", "accounting", "finance"],
    "priority": 90,
    
    "indicators": [
      "invoice", "payment", "amount", "vendor",
      "transaction", "receipt", "balance", "account",
      "total", "subtotal", "tax", "due date",
      "purchase order", "billing", "currency"
    ],
    
    "document_types": [
      "invoice", "receipt", "financial_report",
      "transaction", "statement", "budget",
      "purchase_order", "quote", "payment_confirmation"
    ],
    
    "example_titles": [
      "Invoice #12345",
      "Quarterly Financial Report",
      "Bank Statement",
      "Expense Receipt",
      "Purchase Order",
      "Payment Confirmation"
    ],
    
    "use_cases": [
      "Invoice processing and vendor extraction",
      "Financial report analysis",
      "Transaction categorization",
      "Expense tracking",
      "Accounts payable/receivable management"
    ]
  },
  
  "llm_config": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "temperature": 0.05,
    "max_tokens": 2000,
    "system_prompt": "You are an expert financial document classifier. Extract invoice details, vendor information, amounts, taxes, payment terms, and account numbers with high accuracy. Always identify currency, payment methods, and transaction IDs. Preserve exact numerical values and financial terminology.",
    "fallback_models": [
      "gpt-4o-mini",
      "claude-3-5-haiku-latest",
      "gemini-2.0-flash"
    ]
  },
  
  "document_types": [
    {
      "type": "invoice",
      "display_name": "Invoice",
      "description": "Commercial invoice for goods or services",
      "indicators": ["invoice", "bill", "amount due", "vendor", "invoice number"],
      "required_entities": ["vendor", "amount", "date", "invoice_number"],
      "optional_entities": ["purchaser", "payment_terms", "due_date", "tax"],
      "priority": 100
    },
    {
      "type": "receipt",
      "display_name": "Receipt",
      "description": "Payment receipt confirmation",
      "indicators": ["receipt", "paid", "confirmation", "transaction"],
      "required_entities": ["vendor", "amount", "date"],
      "optional_entities": ["payment_method", "transaction_id"],
      "priority": 90
    },
    {
      "type": "financial_report",
      "display_name": "Financial Report",
      "description": "Financial statement or report",
      "indicators": ["report", "statement", "balance sheet", "income", "profit", "loss"],
      "required_entities": ["period", "date"],
      "optional_entities": ["totals", "accounts"],
      "priority": 80
    }
  ],
  
  "entity_definitions": [
    {
      "type": "Vendor",
      "description": "Vendor or supplier organization",
      "properties": {
        "name": { "type": "string", "required": true },
        "vendor_id": { "type": "string", "required": false },
        "tax_id": { "type": "string", "required": false },
        "address": { "type": "string", "required": false },
        "contact": { "type": "string", "required": false }
      },
      "extraction_methods": ["ner", "pattern", "llm"]
    },
    {
      "type": "Amount",
      "description": "Monetary amounts",
      "properties": {
        "value": { "type": "number", "required": true },
        "currency": { "type": "string", "required": true },
        "amount_type": {
          "type": "enum",
          "values": ["total", "subtotal", "tax", "discount", "fee", "shipping"],
          "required": true
        }
      },
      "extraction_methods": ["pattern", "llm"],
      "patterns": [
        "\\$[0-9,]+(?:\\.[0-9]{2})?",
        "â‚¬[0-9,]+(?:\\.[0-9]{2})?",
        "[0-9,]+(?:\\.[0-9]{2})?\\s*(?:USD|EUR|GBP|BRL)"
      ]
    },
    {
      "type": "Date",
      "description": "Important dates in financial document",
      "properties": {
        "date": { "type": "date", "required": true },
        "date_type": {
          "type": "enum",
          "values": ["invoice_date", "due_date", "payment_date", "transaction_date"],
          "required": true
        }
      },
      "extraction_methods": ["pattern", "llm"]
    },
    {
      "type": "Account",
      "description": "Financial account information",
      "properties": {
        "account_number": { "type": "string", "required": true },
        "account_type": {
          "type": "enum",
          "values": ["checking", "savings", "credit", "vendor_account"]
        },
        "bank_name": { "type": "string", "required": false }
      },
      "extraction_methods": ["pattern", "llm"]
    },
    {
      "type": "Transaction",
      "description": "Financial transaction",
      "properties": {
        "transaction_id": { "type": "string", "required": true },
        "transaction_type": {
          "type": "enum",
          "values": ["payment", "refund", "transfer", "purchase"]
        },
        "amount": { "type": "number", "required": true },
        "status": {
          "type": "enum",
          "values": ["pending", "completed", "failed", "cancelled"]
        }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "PaymentMethod",
      "description": "Method of payment",
      "properties": {
        "method_type": {
          "type": "enum",
          "values": ["credit_card", "debit_card", "bank_transfer", "cash", "check", "paypal"],
          "required": true
        },
        "last_four": { "type": "string", "required": false }
      },
      "extraction_methods": ["llm", "pattern"]
    }
  ],
  
  "relationship_definitions": [
    {
      "type": "ISSUED_BY",
      "description": "Document issued by vendor",
      "source": "Document",
      "target": ["Vendor"],
      "properties": {
        "date": { "type": "date", "required": false }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "PAID_TO",
      "description": "Payment made to vendor",
      "source": "Document",
      "target": ["Vendor"],
      "properties": {
        "amount": { "type": "number", "required": true },
        "date": { "type": "date", "required": false }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "HAS_AMOUNT",
      "description": "Document has monetary amount",
      "source": "Document",
      "target": ["Amount"],
      "properties": {
        "amount_type": { "type": "string", "required": true }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "PAID_VIA",
      "description": "Payment made through payment method",
      "source": "Document",
      "target": ["PaymentMethod"],
      "properties": {
        "date": { "type": "date", "required": false }
      },
      "extraction_methods": ["llm"]
    },
    {
      "type": "RELATES_TO_ACCOUNT",
      "description": "Transaction relates to account",
      "source": "Transaction",
      "target": ["Account"],
      "properties": {},
      "extraction_methods": ["llm"]
    }
  ],
  
  "graph_schema": {
    "nodes": [
      {
        "type": "FinancialDocument",
        "labels": ["Document", "FinancialDocument"],
        "description": "Financial document node in graph",
        "required_properties": ["id", "title", "doc_type", "domain", "created_at"],
        "optional_properties": [
          "invoice_number", "total_amount", "currency",
          "vendor", "due_date", "payment_status"
        ],
        "indexes": [
          { "property": "id", "type": "unique" },
          { "property": "invoice_number", "type": "unique" },
          { "property": "doc_type", "type": "index" },
          { "property": "vendor", "type": "index" },
          { "property": "due_date", "type": "index" }
        ]
      },
      {
        "type": "Vendor",
        "labels": ["Entity", "Vendor"],
        "description": "Vendor or supplier entity",
        "required_properties": ["name"],
        "optional_properties": ["vendor_id", "tax_id", "address", "contact"],
        "indexes": [
          { "property": "name", "type": "fulltext" },
          { "property": "vendor_id", "type": "unique" }
        ]
      },
      {
        "type": "Transaction",
        "labels": ["Transaction"],
        "description": "Financial transaction",
        "required_properties": ["transaction_id", "amount", "date"],
        "optional_properties": ["transaction_type", "status", "payment_method"],
        "indexes": [
          { "property": "transaction_id", "type": "unique" },
          { "property": "date", "type": "index" }
        ]
      }
    ],
    
    "relationships": [
      {
        "type": "ISSUED_BY",
        "source": "FinancialDocument",
        "target": "Vendor",
        "properties": ["date"],
        "required": []
      },
      {
        "type": "PAID_TO",
        "source": "FinancialDocument",
        "target": "Vendor",
        "properties": ["amount", "date"],
        "required": ["amount"]
      },
      {
        "type": "HAS_TRANSACTION",
        "source": "FinancialDocument",
        "target": "Transaction",
        "properties": ["date"],
        "required": []
      }
    ]
  },
  
  "fulltext_schema": {
    "required_fields": ["title", "domain", "doc_type", "created_at"],
    
    "extracted_fields": [
      {
        "name": "vendor",
        "type": "string",
        "description": "Vendor or supplier name",
        "extraction_method": "ner",
        "index": true
      },
      {
        "name": "invoice_number",
        "type": "string",
        "description": "Invoice or document number",
        "extraction_method": "pattern",
        "patterns": ["INV-?\\d+", "#\\d+", "[A-Z]{2,}-\\d+"],
        "index": true
      },
      {
        "name": "total_amount",
        "type": "number",
        "description": "Total amount",
        "extraction_method": "pattern",
        "index": true
      },
      {
        "name": "currency",
        "type": "string",
        "description": "Currency code",
        "extraction_method": "pattern",
        "patterns": ["USD", "EUR", "GBP", "BRL"],
        "index": true
      },
      {
        "name": "due_date",
        "type": "date",
        "description": "Payment due date",
        "extraction_method": "pattern",
        "index": true
      },
      {
        "name": "payment_terms",
        "type": "string",
        "description": "Payment terms",
        "extraction_method": "llm",
        "index": false
      }
    ],
    
    "keyword_extraction": {
      "enabled": true,
      "method": "tfidf",
      "min_frequency": 1,
      "max_keywords": 15,
      "exclude_stopwords": true,
      "preserve_entities": true
    },
    
    "categories": [
      "financial", "invoice", "accounting",
      "payment", "transaction"
    ],
    
    "summary": {
      "enabled": true,
      "method": "llm",
      "max_length": 300
    }
  },
  
  "extraction_rules": [
    {
      "name": "extract_vendor",
      "description": "Extract vendor information",
      "method": "ner",
      "entity_types": ["ORG"],
      "confidence_threshold": 0.85,
      "post_processing": ["deduplicate", "normalize_whitespace"]
    },
    {
      "name": "extract_amounts",
      "description": "Extract monetary amounts",
      "method": "pattern",
      "patterns": [
        {
          "pattern": "(?:total|amount due):?\\s*\\$?([0-9,]+(?:\\.[0-9]{2})?)",
          "type": "total",
          "flags": "i"
        },
        {
          "pattern": "(?:subtotal):?\\s*\\$?([0-9,]+(?:\\.[0-9]{2})?)",
          "type": "subtotal",
          "flags": "i"
        },
        {
          "pattern": "(?:tax):?\\s*\\$?([0-9,]+(?:\\.[0-9]{2})?)",
          "type": "tax",
          "flags": "i"
        }
      ]
    },
    {
      "name": "extract_invoice_number",
      "description": "Extract invoice or document number",
      "method": "pattern",
      "patterns": ["invoice\\s*#?:?\\s*([A-Z0-9-]+)", "document\\s*#?:?\\s*([A-Z0-9-]+)"],
      "flags": "i"
    },
    {
      "name": "extract_dates",
      "description": "Extract financial dates",
      "method": "pattern",
      "patterns": [
        {
          "pattern": "(?:invoice date|date):?\\s*([\\w\\s,]+)",
          "type": "invoice_date",
          "flags": "i"
        },
        {
          "pattern": "(?:due date|payment due):?\\s*([\\w\\s,]+)",
          "type": "due_date",
          "flags": "i"
        }
      ],
      "date_parser": "flexible"
    }
  ],
  
  "validation_rules": [
    {
      "field": "vendor",
      "rules": [
        { "type": "required", "message": "Vendor must be identified" },
        { "type": "min_length", "value": 2 }
      ]
    },
    {
      "field": "total_amount",
      "rules": [
        { "type": "required", "message": "Total amount is required" },
        { "type": "min_value", "value": 0, "message": "Amount must be positive" }
      ]
    },
    {
      "field": "currency",
      "rules": [
        { "type": "required", "message": "Currency must be identified" },
        { "type": "pattern", "value": "[A-Z]{3}", "message": "Invalid currency code" }
      ]
    },
    {
      "field": "confidence",
      "rules": [
        { "type": "min_value", "value": 0.7, "message": "Confidence too low for financial documents" }
      ]
    }
  ]
}

